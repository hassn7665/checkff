

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>التحقق من البطاقة</title>
</head>
<body>
<h2>تحقق من البطاقة</h2>
<div id="result"></div>

<script>
// رابط CSV المنشور من Google Sheet
const sheetCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRAzjYWiKgq1g8LKGfHZUHsQjlE8ibxFG8OsS3PrZYje5QPecRzQNw5onhFWrczCj3YIDa2gkzMd7n/pub?output=csv";

// قراءة البيانات من Google Sheet
let cardsData = [];
fetch(sheetCSV)
.then(response => response.text())
.then(csvText => {
    const rows = csvText.trim().split('\n');
    const headers = rows[0].split(',');
    for(let i=1;i<rows.length;i++){
        const obj = {};
        const values = rows[i].split(',');
        headers.forEach((h,j) => { obj[h.trim()] = values[j]?.trim(); });
        if(obj['sn']) cardsData.push(obj);
    }

    // بعد تحميل CSV، تحقق تلقائي عند وجود ?sn= في الرابط
    const params = new URLSearchParams(window.location.search);
    const snParam = params.get('sn');
    const resultDiv = document.getElementById('result');

    if(snParam){
        const card = cardsData.find(c => c.sn === snParam);
        if(card){
            resultDiv.innerHTML = `<p>الاسم: ${card.name}<br>الرقم النقابي: ${card.union}<br>الصفة: ${card.role}</p>`;
        } else {
            resultDiv.innerHTML = `<p>لم يتم العثور على البطاقة</p>`;
        }
    } else {
        resultDiv.innerHTML = `<p>الرجاء مسح QR للتحقق من البطاقة</p>`;
    }
});
</script>
</body>
</html>